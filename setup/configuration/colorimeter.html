<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Copyright © 2020 by https://github.com/smartAquaMetering. All Rights Reserved. -->
		<meta name="author" content="smartAquaMetering">
		<meta name="description" content="smartColorimeter">
		<meta name="keywords" content="Photometry, Nephelometry">

		<!-- Required meta tags -->
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
		<meta http-equiv="X-UA-Compatible" content="text/html">

		<title>smartColorimeter</title>

		<!-- Bootstrap 4 and jQuery -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

		<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

		<!-- Bootstrap-select -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

		<!-- Bootstrap 4 Toggle -->
		<link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>

		<!-- Bootstrap 4 Tables -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/bootstrap-table.min.css" integrity="sha256-bRy3jXEEDZFb32UUfxldDDaeWXCiIscfWkUrJOBdcN4=" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/bootstrap-table.min.js" integrity="sha256-p8GRrkt9a/cuKDspGMLC0jhsjPKCkGC1XJmF2dYF+Gw=" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/extensions/treegrid/bootstrap-table-treegrid.min.js" integrity="sha256-7/bamjJdCGcpYZP8ASh8WtgzH0TM7Rq3+rPl0CRjZYs=" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/extensions/editable/bootstrap-table-editable.min.js" integrity="sha256-cjlxyGvqWqb9w1nBjTIYNP3Gy3J6j4v/lq1ujrqFIZ4=" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/extensions/export/bootstrap-table-export.min.js" integrity="sha256-IJbTGDnL3KrrGbYJhjEi1jT1ssBnzqPT22eCOuHyGOo=" crossorigin="anonymous"></script>

		<!-- Bootstrap 4 x-editable-->
		<link href="https://cdn.jsdelivr.net/gh/Talv/x-editable@develop/dist/bootstrap4-editable/css/bootstrap-editable.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/gh/Talv/x-editable@develop/dist/bootstrap4-editable/js/bootstrap-editable.min.js"></script>

		<!-- jQuery TimeCircles -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/timecircles/1.5.3/TimeCircles.min.css" integrity="sha512-lZ3AwSh5B+1EgCuXvjkdhFX8xU4dMDO8SPqAn71VFY4luNN8gwKpajLxaZRMSeNMghUghfodtkZAWO2rM7H6Qw==" crossorigin="anonymous" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/timecircles/1.5.3/TimeCircles.min.js" integrity="sha512-FofOhk0jW4BYQ6CFM9iJutqL2qLk6hjZ9YrS2/OnkqkD5V4HFnhTNIFSAhzP3x//AD5OzVMO8dayImv06fq0jA==" crossorigin="anonymous"></script>

		<!-- jQuery treegrid -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-treegrid@0.3.0/css/jquery.treegrid.css" integrity="sha256-gZo//QecN1byuwnUdIUIc7s2oEmAR2+mDhvUEsI0hOw=" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/jquery-treegrid@0.3.0/js/jquery.treegrid.min.js" integrity="sha256-HgE8/BlaJxNT2fERNSTYrtrm//4U8GVpXt3czDj8EwU=" crossorigin="anonymous"></script>

		<!-- jQuery tableExport -->
		<script src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/tableExport.min.js" integrity="sha256-/VfFIAF4GLBN7iah7RFGi+zISoczKczfQTP4Dh4N0uw=" crossorigin="anonymous"></script>

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css" integrity="sha256-rx5u3IdaOCszi7Jb18XD9HSn8bNiEgAqWJbdBvIYYyU=" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/js/fontawesome.min.js" integrity="sha256-TMRxGf3NaZhrxTfD8y/NGiyE4UXBA3udH1l+Co8JDVU=" crossorigin="anonymous"></script>

		<!-- culori -->
		<script src="https://cdn.jsdelivr.net/npm/culori@0.18.0/build/culori.umd.min.js"></script>
		<script src="./mycolors.js"></script>

		<!-- Google Chart -->
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

		<!-- CIE Color Calculator by Bruce Justin Lindbloom -->
		<script src="./ColorConv.js"></script>

		<script defer="" type="text/JavaScript">

			var VersionNumber='0.0.1';
			var VersionDate='2020-12-29';
			var Repository='smartColorimeter';
			var RepositoryPath='https://github.com/smartaquametering/smartPhotometer';
			var Owner='smartAquaMetering';
			var OwnerPath='https://github.com/smartaquametering';
			var Copyright='Copyright © 2020-2021'
			var CopyrightPath='https://github.com/smartaquametering/smartPhotometer/blob/main/LICENSE';
			var Release=Repository+' - '+VersionNumber+' ('+VersionDate+')';

			var SelectedRefWhite;
			var SelectedRGBModel;
			var SelectedAdaptationMethod;
			var SelectedColorScale;

			$(function() {
				document.getElementById('AboutModalBanner').href=RepositoryPath;
				document.getElementById('AboutSupport').href=RepositoryPath;
				document.getElementById('AboutSupport').innerHTML=RepositoryPath;
				document.getElementById('AboutRepository').href=RepositoryPath;
				document.getElementById('AboutRepository').innerHTML=RepositoryPath;
				document.getElementById('AboutCopyright').href=CopyrightPath;
				document.getElementById('AboutCopyright').innerHTML=Copyright;
				document.getElementById('AboutOwner').href=OwnerPath;
				document.getElementById('AboutOwner').innerHTML=Owner;
				document.getElementById('AboutRelease').innerHTML=Release;
				document.getElementById('HelpModalBanner').href=RepositoryPath;
				document.getElementById('FooterRepository').href=RepositoryPath;
				document.getElementById('FooterRepository').innerHTML=Repository+' - '+VersionNumber;
				document.getElementById('FooterOwner').href=OwnerPath;
				document.getElementById('FooterOwner').innerHTML=Owner;

				var SensorXYZ = {};
				var SensorxyY = {};
				var SensorRGB = {};
				var SensorCCT;

				var SampleXYZ = {};
				var EmptySampleXYZ = {};

				var swaction=0;
				var ProtocolID=0;
				var ProtocolData=[];
				var LogData=[];
				var ReadingData=new Array();
					ReadingData[0]=new Array();
					ReadingData[1]=new Array();
					ReadingData[2]=new Array();
						ReadingData[2]['Switch']='Empty Sample';
						ReadingData[2]['GPIO']='16';
					ReadingData[3]=new Array();
						ReadingData[3]['Switch']='Sample';
						ReadingData[3]['GPIO']='16';
					ReadingData[4]=new Array();
						ReadingData[4]['ColorSpace']='-';
						ReadingData[4]['ColorSpaceValue1']='';
						ReadingData[4]['ColorSpaceValue01']='';
						ReadingData[4]['ColorSpaceReference']='D65/<var>2<sup>o</sup></var>';
						ReadingData[4]['Light']='Warm White';
						ReadingData[4]['Wavelength']='410-780';
						ReadingData[4]['GPIO']='12';
						ReadingData[4]['BeamAngle']='180';
						ReadingData[4]['Thickness']='1.4';
					ReadingData[5]=new Array();
						ReadingData[5]['ColorSpace']='CIE-XYZ';
						ReadingData[5]['ColorSpaceValue1']='';
						ReadingData[5]['ColorSpaceValue01']='';
						ReadingData[5]['ColorSpaceReference']='D65/<var>2<sup>o</sup></var>';
					ReadingData[6]=new Array();
						ReadingData[6]['ColorSpace']='CIE-xyY';
						ReadingData[6]['ColorSpaceValue1']='';
						ReadingData[6]['ColorSpaceValue01']='';
						ReadingData[6]['ColorSpaceReference']='D65/<var>2<sup>o</sup></var>';
					ReadingData[7]=new Array();
						ReadingData[7]['ColorSpace']='CIE-L*a*b*';
						ReadingData[7]['ColorSpaceValue1']='';
						ReadingData[7]['ColorSpaceValue01']='';
						ReadingData[7]['ColorDifference']='';
						ReadingData[7]['ColorSpaceReference']='D65/<var>2<sup>o</sup></var>';
					ReadingData[8]=new Array();
						ReadingData[8]['ColorSpace']='CIE-L*u*v*';
						ReadingData[8]['ColorSpaceValue1']='';
						ReadingData[8]['ColorSpaceValue01']='';
						ReadingData[8]['ColorDifference']='';
						ReadingData[8]['ColorSpaceReference']='D65/<var>2<sup>o</sup></var>';
					ReadingData[9]=new Array();
						ReadingData[9]['ColorSpace']='sRGB';
						ReadingData[9]['ColorSpaceValue1']='';
						ReadingData[9]['ColorSpaceValue01']='';
						ReadingData[9]['ColorDifference']='';
						ReadingData[9]['ColorSpaceReference']='D65/<var>2<sup>o</sup></var>';
					ReadingData[10]=new Array();
						ReadingData[10]['ColorSpace']='CCT';
						ReadingData[10]['ColorSpaceValue1']='';
						ReadingData[10]['ColorSpaceValue01']='';
						ReadingData[10]['ColorSpaceReference']='D65/<var>2<sup>o</sup></var>';
					ReadingData[11]=new Array();
						ReadingData[11]['ColorSpace']='Dominant λ';
						ReadingData[11]['ColorSpaceValue1']='';
						ReadingData[11]['ColorSpaceValue01']='';
						ReadingData[11]['ColorSpaceReference']='D65/<var>2<sup>o</sup></var>';
				var SensorData=new Array();
					SensorData[0]=new Array();
						SensorData[0]['Parameter']='<b>CIE-XYZ</b>';
						SensorData[0]['MeasuredValue']='';
						SensorData[0]['ScaledValue']='<input type="checkbox" id="ScaleXYZ">';
					SensorData[1]=new Array();
						SensorData[1]['Parameter']='<b>CIE-xyY</b>';
						SensorData[1]['MeasuredValue']='';
						SensorData[1]['ScaledValue']='<input type="checkbox" id="ScalexyY">';
					SensorData[2]=new Array();
						SensorData[2]['Parameter']='<b>CIE-L*a*b*</b>';
						SensorData[2]['MeasuredValue']='';
						SensorData[2]['ScaledValue']='';
					SensorData[3]=new Array();
						SensorData[3]['Parameter']='<b>CIE-L*u*v*</b>';
						SensorData[3]['MeasuredValue']='';
						SensorData[3]['ScaledValue']='';
					SensorData[4]=new Array();
						SensorData[4]['Parameter']='<b>RGB</b>';
						SensorData[4]['MeasuredValue']='';
						SensorData[4]['ScaledValue']='<input type="checkbox" id="ScaleRGB">';
					SensorData[5]=new Array();
						SensorData[5]['Parameter']='<b>CCT</b> [K]';
						SensorData[5]['MeasuredValue']='';
						SensorData[5]['ScaledValue']='';
					SensorData[6]=new Array();
						SensorData[6]['Parameter']='<b>Dominant λ</b> [nm]';
						SensorData[6]['MeasuredValue']='';
						SensorData[6]['ScaledValue']='';
					SensorData[7]=new Array();
						SensorData[7]['Parameter']='<b>Nearest color(s)</b>';
						SensorData[7]['MeasuredValue']='';
						SensorData[7]['ScaledValue']='';
				function loopDeLoop(e,s){
					var a,l,o=0;
					isNaN(s)&&(s=1),null==e&&(e=1e3);
					var n=setInterval(function(){
						o>0?clearInterval(n):++s>1?o=1:(fetch("/json?view=sensorupdate").then(function(s){
							var o;200===s.status?s.json().then(function(s){
								for(e=s.TTL,a=0;a<s.Sensors.length;a++)
									if(s.Sensors[a].hasOwnProperty("TaskValues"))
										for(l=0;l<s.Sensors[a].TaskValues.length;l++)
											try{o=s.Sensors[a].TaskValues[l].Value}catch(e){o=e.name}finally{
												if("TypeError"!==o){
													tempValue=s.Sensors[a].TaskValues[l].Value;
													if(s.Sensors[a].TaskNumber<3){
														decimalsValue=s.Sensors[a].TaskValues[l].NrDecimals;
														tempValue=parseFloat(tempValue).toFixed(decimalsValue);
														if (s.Sensors[a].TaskNumber==1) {
//															SensorData[(s.Sensors[a].TaskValues[l].ValueNumber-1)]['MeasuredValue']=tempValue;
															if (s.Sensors[a].TaskValues[l].ValueNumber==1) {
																SensorXYZ.X = parseFloat(tempValue);
															} else if (s.Sensors[a].TaskValues[l].ValueNumber==2) {
																SensorXYZ.Y = parseFloat(tempValue);
															} else if (s.Sensors[a].TaskValues[l].ValueNumber==3) {
																SensorXYZ.Z = parseFloat(tempValue);
															} else if (s.Sensors[a].TaskValues[l].ValueNumber==4) {
																SensorCCT = parseFloat(tempValue);
															}
														} else if (s.Sensors[a].TaskNumber==2 && $('#switch_2').prop('checked')===true) {
															if (s.Sensors[a].TaskValues[l].ValueNumber==1) {
																EmptySampleXYZ.X = parseFloat(tempValue);
															} else if (s.Sensors[a].TaskValues[l].ValueNumber==2) {
																EmptySampleXYZ.Y = parseFloat(tempValue);
															} else if (s.Sensors[a].TaskValues[l].ValueNumber==3) {
																EmptySampleXYZ.Z = parseFloat(tempValue);
															}
														} else if (s.Sensors[a].TaskNumber==2 && $('#switch_3').prop('checked')===true) {
															if (s.Sensors[a].TaskValues[l].ValueNumber==1) {
																SampleXYZ.X = parseFloat(tempValue);
															} else if (s.Sensors[a].TaskValues[l].ValueNumber==2) {
																SampleXYZ.Y = parseFloat(tempValue);
															} else if (s.Sensors[a].TaskValues[l].ValueNumber==3) {
																SampleXYZ.Z = parseFloat(tempValue);
															}
														}
													} else {
														var sw="switch_"+(s.Sensors[a].TaskNumber);
														var swd=document.getElementById(sw);
														if (tempValue==0 && $(swd).prop('checked')===true && swaction==0) {
															$(swd).bootstrapToggle('enable', false);
															$(swd).bootstrapToggle('off', false);
														} else if (tempValue==0 && sw=="switch_3" && swaction==0 && $('#switch_2').prop('checked')===true) {
															$('#switch_2').bootstrapToggle('enable', false);
															$('#switch_2').bootstrapToggle('off', false);
														} else if (tempValue==0 && $(swd).prop('checked')===true) {
															swaction = 0;
														} else if (tempValue==1 && $(swd).prop('checked')===false && swaction==0) {
															$(swd).bootstrapToggle('on', false);
														} else if (tempValue==1 && $(swd).prop('checked')===false) {
															swaction = 0;
														};
													}
												}
											}
											e=s.TTL,
											clearInterval(n),
											UpdateSensorData(),
											AppendLogData(),
											loopDeLoop(e,0)
							}):console.log("Looks like there was a problem. Status Code: "+s.status)
						}).catch(function(s){
						}),o=1
					)},e)
				}loopDeLoop(1e3,0);

				function LedSwitches(state) {
					for (i = 2; i < 5; i++) {
						var switchid = "#switch_" + i;
						$(switchid).bootstrapToggle(state);
					}
				};
				// Empty Sample
				$('#switch_2').change(function() {
					if ($(this).prop('checked')===true) {
						swaction = 1;
						$.get('/control?cmd=GPIO,'+ReadingData[2]['GPIO']+',1');
						LedSwitches('disable');
						ResetReadingData();
					} else {
						LedSwitches('enable');
						UpdateReadingData();
					}
				});
				// Sample
				$('#switch_3').change(function() {
					if ($(this).prop('checked')===true) {
						swaction = 1;
						$.get('/control?cmd=GPIO,'+ReadingData[3]['GPIO']+',1');
						LedSwitches('disable');
						ResetTransmissionReadingData();
					} else {
						LedSwitches('enable');
						UpdateReadingData();
						AppendProtocolData();
					}
				});
				// Warm White LED
				$('#switch_4').change(function() {
					swaction = 1;
					if ($(this).prop('checked')===true) {
						swaction = 1;
						$.get('/control?cmd=GPIO,'+ReadingData[4]['GPIO']+',1');
					} else {
						$.get('/control?cmd=GPIO,'+ReadingData[4]['GPIO']+',0');
					}
				});
				$('#SensorTable').bootstrapTable('destroy').bootstrapTable({
					columns: [{
						field: 'Parameter',
						title: 'Sensor'
					}, {
						field: 'MeasuredValue',
						title: 'Values'
					}, {
						field: 'ScaledValue',
						title: 'Scale'
					}],
					data: SensorData
				});
				$('#ReadingTable').bootstrapTable('destroy').bootstrapTable({
					columns: [{
						field: 'Light',
						title: 'Light',
						align: 'left'
					}, {
						field: 'Wavelength',
						title: 'λ',
						align: 'left'
					}, {
						field: 'BeamAngle',
						title: '<var>B<sup>o</sup></var>',
						align: 'right'
					}, {
						field: 'Thickness',
						title: 'd',
						align: 'right'
					}, {
						field: 'ColorSpace',
						title: 'Color space',
						align: 'left'
					}, {
						field: 'ColorSpaceReference',
						title: 'Reference',
						align: 'left'
					}, {
						field: 'ColorSpaceValue01',
						title: '<var>I<sub>0</sub></var>',
						align: 'left'
					}, {
						field: 'ColorSpaceValue1',
						title: '<var>I<sub>T</sub></var>',
						align: 'left'
					}, {
						field: 'ColorDifference',
						title: 'Δ',
						align: 'left'
					}],
					data: ReadingData,
					toolbar: '#ReadingTableToolbar',
					showColumns: true,
					showToggle: true,
					showColumnsToggleAll: true,
					showFullscreen: true
				});
				$('#ReadingTable').bootstrapTable('filterBy', {
					ColorSpace: ['-','sRGB','CIE-XYZ','CIE-xyY','CIE-L*a*b*','CCT','Dominant λ']
				});
				$('#ReadingTableButtonReset').click(function () {
					ResetReadingData();
				});
				function ResetReadingData() {
					for (i = 4; i < 11; i++) {
						ReadingData[i]['ColorSpaceValue1']='';
						ReadingData[i]['ColorSpaceValue01']='';
						ReadingData[i]['ColorDifference']='';
					}
					$('#ReadingTable').bootstrapTable('load', ReadingData);
				};
				function ResetTransmissionReadingData() {
					for (i = 4; i < 11; i++) {
						ReadingData[i]['ColorSpaceValue1']='';
						ReadingData[i]['ColorDifference']='';
					}
					$('#ReadingTable').bootstrapTable('load', ReadingData);
				};
				$('#ProtocolTable').bootstrapTable({
					columns: [{
						field: 'Timestamp',
						title: 'Timestamp',
						sortable: true,
						align: 'left'
					}, {
						field: 'Parameter',
						title: 'Parameter',
						editable: true,
						align: 'left'
					}, {
						field: 'Remark',
						title: 'Remark',
						editable: true,
						align: 'left'
					}, {
						field: 'Light',
						title: 'Light',
						align: 'left'
					}, {
						field: 'Wavelength',
						title: 'λ',
						align: 'right'
					}, {
						field: 'BeamAngle',
						title: '<var>B<sup>o</sup></var>',
						align: 'right'
					}, {
						field: 'Thickness',
						title: 'd',
						align: 'right'
					}, {
						field: 'ColorSpace',
						title: 'Color space',
						align: 'left'
					}, {
						field: 'ColorSpaceReference',
						title: 'Reference',
						align: 'left'
					}, {
						field: 'ColorSpaceValue01',
						title: '<var>I<sub>0</sub></var>',
						align: 'left'
					}, {
						field: 'ColorSpaceValue1',
						title: '<var>I<sub>T</sub></var>',
						align: 'left'
					}, {
						field: 'ColorDifference',
						title: 'Δ',
						align: 'left'
					}],
					data: ProtocolData,
					idField: 'id',
					toolbar: '#ProtocolTableToolbar',
					showColumns: true,
					showToggle: true,
					showColumnsToggleAll: true,
					showFullscreen: true,
					showExport: true,
					treeShowField: 'Timestamp',
					parentIdField: 'pid',
					onPostBody: function() {
						var columns = $('#ProtocolTable').bootstrapTable('getOptions').columns
						if (columns && columns[0][1].visible) {
							$('#ProtocolTable').treegrid({
								initialState: 'collapsed',
								treeColumn: 0,
							})
						}
					}
				});
				$('#ProtocolTableButtonReset').click(function () {
					$('#ProtocolTable').bootstrapTable('removeAll');
				});
				function AppendProtocolData() {
					ProtocolID = ++ProtocolID;
					var ProtocolPID = ProtocolID;
					ProtocolData = [{
							'id': ProtocolPID,
							'pid': 0,
							'Timestamp': new Date().toLocaleString()
					}];
					$('#ProtocolTable').bootstrapTable('append', ProtocolData);
					for (i = 4; i < 11; i++) {
						ProtocolID = ++ProtocolID;
						ProtocolData = [{
								'id': ProtocolID,
								'pid': ProtocolPID,
								'Light': ReadingData[i]['Light'],
								'Wavelength': ReadingData[i]['Wavelength'],
								'BeamAngle': ReadingData[i]['BeamAngle'],
								'Thickness': ReadingData[i]['Thickness'],
								'ColorSpace': ReadingData[i]['ColorSpace'],
								'ColorSpaceReference': ReadingData[i]['ColorSpaceReference'],
								'ColorSpaceValue01': ReadingData[i]['ColorSpaceValue01'],
								'ColorSpaceValue1': ReadingData[i]['ColorSpaceValue1'],
								'ColorDifference': ReadingData[i]['ColorDifference']
						}];
						$('#ProtocolTable').bootstrapTable('append', ProtocolData);
					};
				};
				$('#LogTableButtonBuild').click(function () {
					$('#LogTable').bootstrapTable({
						columns: [{
							field: 'Timestamp',
							title: 'Timestamp',
							sortable: true,
							align: 'left'
						}, {
							field: 'LED',
							title: 'LED',
							align: 'left'
						}, {
							field: 'CIE-XYZ',
							title: 'CIE-XYZ',
							align: 'right'
						}, {
							field: 'CIE-xyY',
							title: 'CIE-xyY',
							align: 'right'
						}, {
							field: 'CIE-L*a*b*',
							title: 'CIE-L*a*b*',
							align: 'right'
						}, {
							field: 'CCT',
							title: 'CCT',
							align: 'right'
						}],
						data: LogData,
						toolbar: '#LogTableToolbar',
						showColumns: true,
						showToggle: true,
						showColumnsToggleAll: true,
						showFullscreen: true,
						showExport: true
					});
				});
				$('#LogTableButtonReset').click(function () {
					$('#LogTable').bootstrapTable('removeAll');
				});
				$('#LogTableButtonDestroy').click(function () {
					$('#LogTable').bootstrapTable('destroy');
				});
				function AppendLogData() {
					LogData = [{
							'Timestamp': new Date().toLocaleString(),
							'LED': $('#switch_4').prop('checked'),
							'CIE-XYZ': SensorData[0]['MeasuredValue'],
							'CIE-xyY': SensorData[1]['MeasuredValue'],
							'CIE-L*a*b*': SensorData[2]['MeasuredValue'],
							'CCT': SensorData[5]['MeasuredValue']
					}];
					$('#LogTable').bootstrapTable('append', LogData);
				};


				$(document).ready(function(){
					$('#RefWhite').trigger('change');
					$('#RGBModel').trigger('change');
					$('#Adaptation').trigger('change');
					$('#ColorScale').trigger('change');
				});
				$('#RefWhite').change(function() {
					SelectedRefWhite = parseInt($(this).prop('value'));
					GetRefWhite(SelectedRefWhite);
				});
				$('#RGBModel').change(function() {
					SelectedRGBModel = parseInt($(this).prop('value'));
					GetRGBModel(SelectedRGBModel);
				});
				$('#Adaptation').change(function() {
					SelectedAdaptationMethod = parseInt($(this).prop('value'));
					GetAdaptation(SelectedAdaptationMethod);
				});
				$('#ColorScale').change(function() {
					SelectedColorScale = parseInt($(this).prop('value'));
				});
				function UpdateSensorData() {

					SensorXYZ.Reference = RefWhite.Name;
					SensorxyY = XYZ2xyY(SensorXYZ);
					SensorRGB = XYZ2RGB(SensorXYZ);

					SensorData[0]['MeasuredValue'] = printObject(ScaleXYZ(SensorXYZ));
					SensorData[1]['MeasuredValue'] = printObject(ScalexyY(SensorxyY));
					SensorData[2]['MeasuredValue'] = printObject(XYZ2Lab(SensorXYZ));
					SensorData[3]['MeasuredValue'] = printObject(XYZ2Luv(SensorXYZ));
					SensorData[4]['MeasuredValue'] = printObject(ScaleRGB(SensorRGB));
					SensorData[5]['MeasuredValue'] = "<pre>Robertson<span style='white-space: pre'>: "+XYZ2CCT(SensorXYZ)+"</br>McCamy   : "+XYZ2CCT_McCamy(SensorXYZ)+"</pre>";
					SensorData[6]['MeasuredValue'] = CalcDomWavelength(SensorXYZ);
					SensorData[7]['MeasuredValue'] = IndexColors(IodineColorIndex)(ConvertXYZ(SensorXYZ), 2).map(item => item.name);

					$('#SensorTable').bootstrapTable('load', SensorData);
					DrawCharts();
				};
				function UpdateReadingData() {

					if (EmptySampleXYZ.x !== '') {
						EmptySampleXYZ.Reference = RefWhite.Name;

						ReadingData[5]['ColorSpaceValue01'] = printObject(ScaleXYZ(EmptySampleXYZ));
						ReadingData[6]['ColorSpaceValue01'] = printObject(ScalexyY(XYZ2xyY(EmptySampleXYZ)));
						ReadingData[7]['ColorSpaceValue01'] = printObject(XYZ2Lab(EmptySampleXYZ));
						ReadingData[8]['ColorSpaceValue01'] = printObject(XYZ2Luv(EmptySampleXYZ));
						ReadingData[9]['ColorSpaceValue01'] = printObject(ScaleRGB(XYZ2RGB(EmptySampleXYZ)));
						ReadingData[10]['ColorSpaceValue01'] = "<pre>Robertson<span style='white-space: pre'>: "+XYZ2CCT(EmptySampleXYZ)+"</br>McCamy   : "+XYZ2CCT_McCamy(EmptySampleXYZ)+"</pre>";
						ReadingData[11]['ColorSpaceValue01'] = CalcDomWavelength(EmptySampleXYZ);
//				SensorData[7]['MeasuredValue'] = IndexColors(IodineColorIndex)(ConvertXYZ(SensorXYZ), 2).map(item => item.name);
					}
					if (SampleXYZ.x !== '') {
						SampleXYZ.Reference = RefWhite.Name;

						ReadingData[5]['ColorSpaceValue1'] = printObject(ScaleXYZ(SampleXYZ));
						ReadingData[6]['ColorSpaceValue1'] = printObject(ScalexyY(XYZ2xyY(SampleXYZ)));
						ReadingData[7]['ColorSpaceValue1'] = printObject(XYZ2Lab(SampleXYZ));
						ReadingData[8]['ColorSpaceValue1'] = printObject(XYZ2Luv(SampleXYZ));
						ReadingData[9]['ColorSpaceValue1'] = printObject(ScaleRGB(XYZ2RGB(SampleXYZ)));
						ReadingData[10]['ColorSpaceValue1'] = "<pre>Robertson<span style='white-space: pre'>: "+XYZ2CCT(SampleXYZ)+"</br>McCamy   : "+XYZ2CCT_McCamy(SampleXYZ)+"</pre>";
						ReadingData[11]['ColorSpaceValue1'] = CalcDomWavelength(SampleXYZ);
//				SensorData[7]['MeasuredValue'] = IndexColors(IodineColorIndex)(ConvertXYZ(SensorXYZ), 2).map(item => item.name);
					}
					if (EmptySampleXYZ.x !== '' && SampleXYZ.x !== '') {

						let Difference_RGB = {mode:$('#RGBModel').prop('value')};
						let Difference_CIELAB = {mode:'lab65'};

						let differencergb = culori.differenceEuclidean();
						Difference_RGB['ΔC'] = differencergb(EmptySampleXYZ, SampleXYZ);

						let differenceCie1976 = culori.differenceCie76();
						Difference_CIELAB['<var>CIE1976 ΔE<sup>*</sup><sub>ab</sub></var>'] = differenceCie1976(EmptySampleXYZ, SampleXYZ);

						let differenceCie1994 = culori.differenceCie94();
						Difference_CIELAB['<var>CIE1994 ΔE<sup>*</sup><sub>94</sub></var>'] = differenceCie1994(EmptySampleXYZ, SampleXYZ);

						let differenceCie2000 = culori.differenceCiede2000();
						Difference_CIELAB['<var>CIE2000 ΔE<sup>*</sup><sub>00</sub></var>'] = differenceCie2000(EmptySampleXYZ, SampleXYZ);

						ReadingData[7]['ColorDifference']=printObject(Difference_CIELAB);
						ReadingData[9]['ColorDifference']=printObject(Difference_RGB);
					}
					$('#ReadingTable').bootstrapTable('load', ReadingData);
				};

				google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback();

				function DrawCharts() {

					var sRGBCanvas = document.getElementById("sRGBCanvas");
					var sRGBctx = sRGBCanvas.getContext("2d");
					sRGBctx.fillStyle = SensorRGB.HEX;
					sRGBctx.fillRect(0,0,400,150);

					var CIExyChartData = new google.visualization.DataTable();
					CIExyChartData.addColumn('number', '');
					CIExyChartData.addColumn('number', 'Sensor');
					CIExyChartData.addColumn('number', 'White Point (' + RefWhite.Name + ")");
					CIExyChartData.addColumn('number', RGBModel.Name);
					CIExyChartData.addColumn('number', RGBModel.Name);
					CIExyChartData.addColumn('number', 'Planckian locus');
					CIExyChartData.addColumn({type:'number', role:'annotation'});
					CIExyChartData.addColumn('number', 'Spectrum locus');
					CIExyChartData.addColumn({type:'number', role:'annotation'});
					CIExyChartData.addRows([
						[SensorxyY.x, SensorxyY.y, null, null, null, null, null, null, null],
						[RefWhite.x, null, RefWhite.y, null, null, null, null, null, null],
						[RGBModel.xr, null, null, RGBModel.yr, null, null, null, null, null],
						[RGBModel.xg, null, null, RGBModel.yg, null, null, null, null, null],
						[RGBModel.xb, null, null, RGBModel.yb, null, null, null, null, null],
						[RGBModel.xb, null, null, null, RGBModel.yb, null, null, null, null],
						[RGBModel.xr, null, null, null, RGBModel.yr, null, null, null, null],
						[0.6528, null, null, null, null, 0.3445, 1000, null, null],
						[0.5857, null, null, null, null, 0.3931, null, null, null],
						[0.5267, null, null, null, null, 0.4133, 2000, null, null],
						[0.4770, null, null, null, null, 0.4137, null, null, null],
						[0.4369, null, null, null, null, 0.4041, 3000, null, null],
						[0.3946, null, null, null, null, 0.3851, null, null, null],
						[0.3608, null, null, null, null, 0.3635, 4500, null, null],
						[0.3324, null, null, null, null, 0.3410, null, null, null],
						[0.3135, null, null, null, null, 0.3236, 6500, null, null],
						[0.2952, null, null, null, null, 0.3048, null, null, null],
						[0.2806, null, null, null, null, 0.2883, 10000, null, null],
						[0.1741, null, null, null, null, null, null, 0.0050, 380],
						[0.1440, null, null, null, null, null, null, 0.0297, 460],
						[0.0913, null, null, null, null, null, null, 0.1327, 480],
						[0.0454, null, null, null, null, null, null, 0.2950, 490],
						[0.0082, null, null, null, null, null, null, 0.5384, 500],
						[0.0139, null, null, null, null, null, null, 0.7502, 510],
						[0.0743, null, null, null, null, null, null, 0.8338, 520],
						[0.1547, null, null, null, null, null, null, 0.8059, 530],
						[0.2296, null, null, null, null, null, null, 0.7543, 540],
						[0.3016, null, null, null, null, null, null, 0.6923, 550],
						[0.3731, null, null, null, null, null, null, 0.6245, 560],
						[0.4441, null, null, null, null, null, null, 0.5547, 570],
						[0.5125, null, null, null, null, null, null, 0.4866, 580],
						[0.5752, null, null, null, null, null, null, 0.4242, 590],
						[0.6270, null, null, null, null, null, null, 0.3725, 600],
						[0.6915, null, null, null, null, null, null, 0.3083, 620],
						[0.7347, null, null, null, null, null, null, 0.2653, 700]
					]);

					let CIExyChartOptions = {
						hAxis: {title: 'x', minValue: 0, maxValue: 0.8},
						vAxis: {title: 'y', minValue: 0, maxValue: 0.9},
						width: 533,
						height: 600,
						title: 'CIE 1931 Chromaticity Diagram',
						backgroundColor: 'none',
						annotations: {
							textStyle: {
								fontSize: 11,
								opacity: 0.6
							}
						},
						series: {
							0:{type: 'line', color: 'black', visibleInLegend: true, lineWidth: 0, pointShape: { type: 'star', sides: 5, dent: 0.2 }, pointSize: 18},
							1:{type: 'line', color: 'grey', visibleInLegend: true, lineWidth: 0, pointSize: 6},
							2:{type: 'line', color: 'grey', visibleInLegend: true, lineWidth: 1},
							3:{type: 'line', color: 'grey', visibleInLegend: false}, lineWidth: 1,
							4:{type: 'line', color: 'blue', visibleInLegend: true, curveType: 'function'},
							5:{type: 'line', color: 'black', visibleInLegend: true, curveType: 'function', lineWidth: 0}
						}
					};
					var CIExyChart = new google.visualization.LineChart(document.getElementById('CIExyChart'));
					CIExyChart.draw(CIExyChartData, CIExyChartOptions);
					// This two lines are the ones that do the magic to load the background image to the proper chart position
					var boundingBox = CIExyChart.getChartLayoutInterface().getChartAreaBoundingBox(); 
					$('#CIExyChartBackground').css('background-position', boundingBox.left + "px " + boundingBox.top + "px").css('background-size', boundingBox.width + "px " + boundingBox.height + "px");
				}

				function IndexColors(ColorIndex) {
					let ReferenceColors = Object.entries(ColorIndex).map(entry => {
						let name = entry[0];
						let values = entry[1].split(/\s*,\s*/);
						let color = culori.lab65({
							l: +values[0],
							a: +values[1],
							b: +values[2]
						});
						return {
							name,
							color
						};
					});
					let nearestReferenceColors = culori.nearest(ReferenceColors, culori.differenceCie76(), item => item.color);
					return nearestReferenceColors;
				}

				function ConvertXYZ({mode, X, Y, Z}) {
					let res = {
						x: X,
						y: Y,
						z: Z
					}
					return res;
				}

				function ScaleXYZ({Reference, X, Y, Z}) {
					var Scale = ($('#ScaleXYZ').prop('checked') == false) ? 1.0 : 100.0;
					var Digits = ($('#ScaleXYZ').prop('checked') == false) ? 6 : 4;

					if ($('#ScaleXYZ').prop('checked')===true) {
						SensorData[0]['ScaledValue']='<input id="ScaleXYZ" type="checkbox" checked="checked">';
					} else {
						SensorData[0]['ScaledValue']='<input id="ScaleXYZ" type="checkbox">';
					}
					let res = {
						X: (Scale * X).toFixed(Digits),
						Y: (Scale * Y).toFixed(Digits),
						Z: (Scale * Z).toFixed(Digits),
						Reference: Reference,
						Scale: Scale
					}
					return res;
				}

				function ScalexyY({Reference, x, y, Y}) {
					var Scale = ($('#ScalexyY').prop('checked') == false) ? 1.0 : 100.0;
					var Digits = ($('#ScalexyY').prop('checked') == false) ? 6 : 4;

					if ($('#ScalexyY').prop('checked')===true) {
						SensorData[1]['ScaledValue']='<input id="ScalexyY" type="checkbox" checked="checked">';
					} else {
						SensorData[1]['ScaledValue']='<input id="ScalexyY" type="checkbox">';
					}

					let res = {
						x: (x).toFixed(6),
						y: (y).toFixed(6),
						Y: (Scale * Y).toFixed(Digits),
						Reference: Reference,
						Scale: Scale
					}
					return res;
				}

				function ScaleRGB({Model, Reference, Adaptation, Gamma, HEX, R, G, B}) {
					var Scale = ($('#ScaleRGB').prop('checked') == false) ? 1.0 : 255.0;
					var Digits = ($('#ScaleRGB').prop('checked') == false) ? 6 : 4;

					if ($('#ScaleRGB').prop('checked')===true) {
						SensorData[4]['ScaledValue']='<input id="ScaleRGB" type="checkbox" checked="checked">';
					} else {
						SensorData[4]['ScaledValue']='<input id="ScaleRGB" type="checkbox">';
					}

					let res = {
						R: (Scale * R).toFixed(Digits),
						G: (Scale * G).toFixed(Digits),
						B: (Scale * B).toFixed(Digits),
						HEX: HEX,
						Model: Model,
						Reference: Reference,
						Adaptation: Adaptation,
						Gamma: Gamma,
						Scale: Scale
					}
					return res;
				}

				function printObject(obj) {
					var result = '';
					var objValue;
					for (var i in obj) {
						if (obj.hasOwnProperty(i)) {
							objValue=`${obj[i]}`;
//							var x = parseFloat(objValue).toFixed(4); 
//							if (isNaN(x)) {
//								var x;
//							} else {
//								objValue=x;
//							}
							result += `${i}`+': '+objValue+'</br>';
						}
					}
					return result;
				}

				window.onbeforeunload = function() {
					return "Dude, are you sure you want to leave? Think of the kittens!";
				}

				jQuery.event.special.mousewheel = {
					setup: function( _, ns, handle ) {
						this.addEventListener('mousewheel', handle, { passive: !ns.includes('noPreventDefault') });
					}
				};
			});
		</script>
	</head>
	<body>
		<div class="container">
			<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
				<a class="navbar-brand"><img src="/logo.png" width="40" height="30" class="" alt=""> smartColorimeter</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarResponsive">
					<ul class="navbar-nav">
						<li class="nav-item"><a class="nav-link" href="/dashboard.esp" target="_blank">Dashboard</a></li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" id="navbarSystem" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">System</a>
							<div class="dropdown-menu" aria-labelledby="navbarSystem">
								<a class="dropdown-item" href="/" target="_blank">System Info and Settings</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="/json?view=sensorupdate" target="_blank">Sensor Status</a>
								<a class="dropdown-item" href="/json" target="_blank">System Configuration</a>
							</div>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" id="navbarHelp" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Help</a>
							<div class="dropdown-menu" aria-labelledby="navbarHelp">
								<a class="dropdown-item" href="#AboutModal" data-toggle="modal" data-target="#AboutModal">About</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="#HelpModal" data-toggle="modal" data-target="#HelpModal">Help</a>
							</div>
						</li>
					</ul>
				</div>
			</nav>

			<div class="modal fade" id="AboutModal" tabindex="-1" aria-labelledby="AboutModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-xl">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="AboutModalLabel">About</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">

							<h5><a href="#" id="AboutModalBanner" target="_blank"><img class="img-fluid" alt="" src="/banner.png"></a></h5>

							<h5>Firmware build</h5>
							<div class="card p-3 bg-light" style="margin: 0.5em 0em 1.5em;">
								ESPEasy (mega), ESP_Easy_mega_20201103_custom_ESP32_4M316k
							</div>
							<h5>Release</h5>
							<div class="card p-3 bg-light" style="margin: 0.5em 0em 1.5em;" id="AboutRelease"></div>
							<h5>HTML, CSS, and JavaScript framework</h5>
							<div class="card p-3 bg-light" style="margin: 0.5em 0em 1.5em;">
								Bootstrap 4 CSS - https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
								<br>jQuery - https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js
								<br>Bootstrap 4 JS bundle - https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js
								<br>Bootstrap 4 Toggle CSS - https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css
								<br>Bootstrap 4 Toggle JS - https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js
								<br>Bootstrap 4 Tables CSS - https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/bootstrap-table.min.css
								<br>Bootstrap 4 Tables JS - https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/bootstrap-table.min.js
								<br>Bootstrap 4 Tables treegrid - https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/extensions/treegrid/bootstrap-table-treegrid.min.js
								<br>Bootstrap 4 Tables editable - https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/extensions/editable/bootstrap-table-editable.min.js
								<br>Bootstrap 4 Tables export - https://cdn.jsdelivr.net/npm/bootstrap-table@1.18.0/dist/extensions/export/bootstrap-table-export.min.js
								<br>Bootstrap 4 x-editable CSS - https://cdn.jsdelivr.net/gh/Talv/x-editable@develop/dist/bootstrap4-editable/css/bootstrap-editable.css
								<br>Bootstrap 4 x-editable JS - https://cdn.jsdelivr.net/gh/Talv/x-editable@develop/dist/bootstrap4-editable/js/bootstrap-editable.min.js
								<br>jQuery TimeCircles CSS - https://cdnjs.cloudflare.com/ajax/libs/timecircles/1.5.3/TimeCircles.min.css
								<br>jQuery TimeCircles JS - https://cdnjs.cloudflare.com/ajax/libs/timecircles/1.5.3/TimeCircles.min.js
								<br>jQuery treegrid CSS - https://cdn.jsdelivr.net/npm/jquery-treegrid@0.3.0/css/jquery.treegrid.css
								<br>jQuery treegrid JS - https://cdn.jsdelivr.net/npm/jquery-treegrid@0.3.0/js/jquery.treegrid.min.js
								<br>jQuery tableExport - https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/tableExport.min.js
								<br>Font Awesome CSS - https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css
								<br>Font Awesome JS - https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/js/fontawesome.min.js
							</div>
							<h5>Support and documentation</h5>

							<div class="card p-3 bg-light" style="margin: 0.5em 0em 1.5em;">
								<samp>
									GitHub: <a href="#" id="AboutSupport" target="_blank"></a>
								</samp>
							</div>

							<h5>Development</h5>

							<div class="card p-3 bg-light" style="margin: 0.5em 0em 1.5em;">
								<samp>
									GitHub: <a href="#" id="AboutRepository" target="_blank"></a>
								</samp>
							</div>

							<h5>Copyrights</h5>

							<div class="card p-3 bg-light" style="margin: 0.5em 0em 1.5em;">
								<samp>
									smartColorimeter - <a href="#" id="AboutCopyright" target="_blank"></a> by <a href="#" id="AboutOwner" target="_blank"></a>. All Rights Reserved. Licensed under <a href="http://www.gnu.org/licenses/gpl.html" target="_blank">GNU GPL v3 or higher</a>.
								</samp>
							</div>
								
							<h5>Licenses</h5>

							<p>All of the source code to this project is available under licenses which are both <a href="http://www.gnu.org/philosophy/free-sw.html" target="_blank">free</a> and <a href="http://www.opensource.org/docs/definition.php" target="_blank">open source</a>.<br>
							Most of it is available under <a href="http://www.gnu.org/licenses/gpl.html" target="_blank">GNU GPL</a> and <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a>.</p>

							<p>The remainder of the software which is not under the GNU GPL is available under one of a variety of other licenses. Those that require reproduction of the license text in the distribution are given below.<br>
							(Note: Your copy of this product may not contain code covered by one or more of the licenses listed here, depending on the exact product and version you choose.)</p>

							<div class="card p-3 bg-light" style="margin: 0.5em 0em 1.5em;">
								<samp>
									ESPEasy - <a href="https://github.com/letscontrolit/ESPEasy/blob/mega/License.txt" target="_blank">Copyright © letscontrolit</a>. Licensed under <a href="https://github.com/letscontrolit/ESPEasy/blob/mega/License.txt" target="_blank">GNU GPL v3 or higher</a>.
									<br>Bootstrap - <a href="https://github.com/twbs/bootstrap/blob/v4-dev/LICENSE" target="_blank">Copyright © 2011-2020 Twitter, Inc</a>. Licensed under <a href="https://github.com/twbs/bootstrap/blob/v4-dev/LICENSE" target="_blank">MIT License</a>.
									<br>jQuery - <a href="https://github.com/jquery/jquery/blob/master/LICENSE.txt" target="_blank">Copyright © OpenJS Foundation and other contributors</a>. Licensed under <a href="https://github.com/jquery/jquery/blob/master/LICENSE.txt" target="_blank">MIT License</a>.
									<br>Bootstrap 4 Toggle - <a href="https://github.com/gitbrent/bootstrap4-toggle/blob/master/LICENSE" target="_blank">Copyright © 2018 by Brent Ely</a>. Licensed under <a href="https://github.com/gitbrent/bootstrap4-toggle/blob/master/LICENSE" target="_blank">MIT License</a>.
									<br>Bootstrap 4 Tables - <a href="https://github.com/wenzhixin/bootstrap-table/blob/master/LICENSE" target="_blank">Copyright © 2012-2019 by Zhixin Wen</a>. Licensed under <a href="https://github.com/wenzhixin/bootstrap-table/blob/master/LICENSE" target="_blank">MIT License</a>.
									<br>jQuery TimeCircles - <a href="https://github.com/wimbarelds/TimeCircles/blob/master/MIT.txt" target="_blank">Copyright © 2013 by Wim Barelds</a>. Licensed under <a href="https://github.com/wimbarelds/TimeCircles/blob/master/MIT.txt" target="_blank">MIT License</a>.
									<br>jQuery treegrid - <a href="https://github.com/maxazan/jquery-treegrid/blob/master/LICENSE" target="_blank">Copyright © 2013 by Maksym Pomazan</a>. Licensed under <a href="https://github.com/maxazan/jquery-treegrid/blob/master/LICENSE" target="_blank">MIT License</a>.
									<br>jQuery tableExport - <a href="https://github.com/hhurz/tableExport.jquery.plugin/blob/master/LICENSE" target="_blank">Copyright © 2015-2020 by hhurz</a>. Licensed under <a href="https://github.com/hhurz/tableExport.jquery.plugin/blob/master/LICENSE" target="_blank">MIT License</a>.
									<br>Font Awesome - by <a href="https://github.com/FortAwesome/Font-Awesome/blob/master/LICENSE.txt" target="_blank">Font Awesome</a>.
								</samp>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>

			<div class="modal fade" id="HelpModal" tabindex="-1" aria-labelledby="HelpModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-xl">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="HelpModalLabel">Help</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">

							<h5><a href="#" id="HelpModalBanner" target="_blank"><img class="img-fluid" alt="" src="/banner.png"></a></h5>

							<h5 class="mt-4 mb-4">Legend</h5>
							<dl class="row">
								<dt class="col-sm-3">λ</dt>
								<dd class="col-sm-9 text-truncate">Wavelength [nm]</dd>

								<dt class="col-sm-3"><var>B<sup>o</sup></var></dt>
								<dd class="col-sm-9 text-truncate">
									Beam (measuring) angle [<var><sup>o</sup></var>]</br>
									<var>180 <sup>o</sup>: Transmitted light measurement (Absorbance)</var></br>
									<var>90 <sup>o</sup>: Nephelometric turbidity (scattered light) measurement</var>
								</dd>

								<dt class="col-sm-3"><var>I<sub>0</sub></var></dt>
								<dd class="col-sm-9 text-truncate">Intensity of incident light [lux]</dd>

								<dt class="col-sm-3"><var>I<sub>T</sub></var></dt>
								<dd class="col-sm-9 text-truncate">Intensity of transmitted light [lux]</dd>

								<dt class="col-sm-3">T = <var>I<sub>T</sub></var> / <var>I<sub>0</sub></var></dt>
								<dd class="col-sm-9 text-truncate">
									Transmission</br>
									Energy passing through</br>
									Range: 0.0 - 1.0
								</dd>

								<dt class="col-sm-3">A = 1 - T</dt>
								<dd class="col-sm-9 text-truncate">
									Absorption</br>
									Energy lost
								</dd>

								<dt class="col-sm-3"><var>E<sub>λ</sub></var> = - log ( T ) = <var>ε<sub>λ</sub></var> * c * d</dt>
								<dd class="col-sm-9 text-truncate">
									Absorbance</br>
									Attenuation</br>
									Lambert-Beer law</br>
									Optimum range: 0.1 – 1.0
								</dd>

								<dt class="col-sm-3"><var>SAC<sub>λ</sub></var> = <var>E<sub>λ</sub></var> / d * 100</dt>
								<dd class="col-sm-9 text-truncate">Spectral Absorption Coefficient [<var>m<sup>-1</sup></var>]</dd>

								<dt class="col-sm-3">c = <var>E<sub>λ</sub></var> / ( <var>ε<sub>λ</sub></var> * d ) = <var>E<sub>λ</sub></var> * F</dt>
								<dd class="col-sm-9 text-truncate">Concentration of absorbing substance in the liquid [mol/l]</dd>

								<dt class="col-sm-3">F = 1 / ( <var>ε<sub>λ</sub></var> * d )</dt>
								<dd class="col-sm-9 text-truncate">
									Factor</br>
									Test specific
								</dd>

								<dt class="col-sm-3"><var>ε<sub>λ</sub></var></dt>
								<dd class="col-sm-9 text-truncate">Molar decadic extinction coefficient [l/mol/cm]</dd>

								<dt class="col-sm-3">d</dt>
								<dd class="col-sm-9 text-truncate">Thickness of the solution layer [cm]</dd>

								<dt class="col-sm-3">Turbidity</dt>
								<dd class="col-sm-9 text-truncate">Opacity, clouding, haze</dd>

								<dt class="col-sm-3">FNU</dt>
								<dd class="col-sm-9 text-truncate">Formazine Nephelometric Unit</dd>

								<dt class="col-sm-3">NTU</dt>
								<dd class="col-sm-9 text-truncate">Nephelometric Turbidity Unit</dd>

								<dt class="col-sm-3">FAU</dt>
								<dd class="col-sm-9 text-truncate">Formazine Attenuation Unit</dd>
							</dl>

							<h5 class="mt-4 mb-4">Measurement methods</h5>
							<dl class="row">
								<dt class="col-sm-3">Photometry</dt>
								<dd class="col-sm-9 text-truncate">
									Absorbance measurement (transmitted light or absorption measurement)</br>
									Recommended measuring range: 40–4000 FAU (DIN EN ISO 7027)</br>
									Light source and detector are located on the same axis (180° angle).</br>
									The reduced light intensity which remains after passing through the sample is measured
								</dd>
								<dt class="col-sm-3">Nephelometry</dt>
								<dd class="col-sm-9 text-truncate">
									Scattered light measurement</br>
									Recommended measuring range: 0–40 FNU (DIN EN ISO 7027)</br>
									Light source and detector are oriented at an angle of 90° relative to each other
								</dd>
							</dl>

						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>

			<p>
				<div class="row">
					<div class="col">
						<input id="switch_2" type="checkbox" data-toggle="toggle" data-width="300" data-size="lg" data-on="Running</br>Do not touch" data-off="Empty&nbsp;Sample</br><var>I<sub>0</sub></var>" data-onstyle="secondary" data-offstyle="light">
					</div>
					<div class="col">
						<input id="switch_3" type="checkbox" data-toggle="toggle" data-width="300" data-size="lg" data-on="Running</br>Do not touch" data-off="Sample</br><var>I<sub>T</sub></var>" data-onstyle="secondary" data-offstyle="light">
					</div>
				</div>
			</p>
			<p>
			<div class="row">
				<div class="col">
					<input id="switch_4" type="checkbox" data-toggle="toggle" data-width="140" data-size="lg" data-onstyle="outline-dark" data-offstyle="outline-dark" data-on="On" data-off="Off">
				</div>
			</div>
			</p>

			<h4 class="mt-4 mb-4">Status</h4>
			<table id="SensorTable"></table>

			<p>
				<div class="input-group mb-3">
					<div class="input-group-prepend">
						<label class="input-group-text" for="RefWhite">Reference white</label>
					</div>
					<select class="form-control selectpicker show-tick" data-live-search="true" data-size="5" id="RefWhite">
						<optgroup label="Standard illuminants for the 2 degree field of view (1931)">
							<option value="0" data-subtext="2856 K° - Incandescent (Tungsten)">A/2°</option>
							<option value="1" data-subtext="4874 K° - Direct sunlight at noon (obsolete)">B/2°</option>
							<option value="2" data-subtext="6774 K° - North sky daylight (average) (obsolete)">C/2°</option>
							<option value="3" data-subtext="5003 K° - Horizon light / ICC profile PCS"selected>D50/2°</option>
							<option value="4" data-subtext="5503 K° - Mid-morning / Mid-afternoon daylight">D55/2°</option>
							<option value="5" data-subtext="6504 K° - Noon daylight / Television, sRGB color space">D65/2°</option>
							<option value="6" data-subtext="7504 K° - North sky daylight">D75/2°</option>
							<option value="7" data-subtext="5454 K° - Equal energy">E/2°</option>
							<option value="8" data-subtext="6430 K° - Daylight (fluorescent)">F1/2°</option>
							<option value="9" data-subtext="4230 K° - Cool white (fluorescent)">F2/2°</option>
							<option value="10" data-subtext="3450 K° - White (fluorescent)">F3/2°</option>
							<option value="11" data-subtext="2940 K° - Warm white (fluorescent)">F4/2°</option>
							<option value="12" data-subtext="6350 K° - Daylight (fluorescent)">F5/2°</option>
							<option value="13" data-subtext="4150 K° - Light white (fluorescent)">F6/2°</option>
							<option value="14" data-subtext="6500 K° - Daylight / D65 (Simulator)">F7/2°</option>
							<option value="15" data-subtext="5000 K° - D50 (Simulator) / Sylvania F40 Design 50">F8/2°</option>
							<option value="16" data-subtext="4150 K° - Cool white deluxe (fluorescent)">F9/2°</option>
							<option value="17" data-subtext="5000 K° - Philips TL85 / Ultralume 50">F10/2°</option>
							<option value="18" data-subtext="4000 K° - Philips TL84 / Ultralume 40">F11/2°</option>
							<option value="19" data-subtext="3000 K° - Philips TL83 / Ultralume 30">F12/2°</option>
							<option value="20" data-subtext="2733 K° - Phosphor-converted blue">LED-B1/2°</option>
							<option value="21" data-subtext="2998 K° - Phosphor-converted blue">LED-B2/2°</option>
							<option value="22" data-subtext="4103 K° - Phosphor-converted blue">LED-B3/2°</option>
							<option value="23" data-subtext="5109 K° - Phosphor-converted blue">LED-B4/2°</option>
							<option value="24" data-subtext="6598 K° - Phosphor-converted blue">LED-B5/2°</option>
							<option value="25" data-subtext="2851 K° - Mixing of phosphor-converted blue LED and red LED (blue-hybrid)">LED-BH1/2°</option>
							<option value="26" data-subtext="2840 K° - Mixing of red, green, and blue LEDs">LED-RGB1/2°</option>
							<option value="27" data-subtext="2724 K° - Phosphor-converted violet">LED-V1/2°</option>
							<option value="28" data-subtext="4070 K° - Phosphor-converted violet">LED-V2/2°</option>
						</optgroup>
						<optgroup label="Standard illuminants for the 10 degree field of view (1964)">
							<option value="30" data-subtext="2856 K° - Incandescent (Tungsten)">A/10°</option>
							<option value="31" data-subtext="4874 K° - Direct sunlight at noon (obsolete)">B/10°</option>
							<option value="32" data-subtext="6774 K° - North sky daylight (average) (obsolete)">C/10°</option>
							<option value="33" data-subtext="5003 K° - Horizon light / ICC profile PCS">D50/10°</option>
							<option value="34" data-subtext="5503 K° - Mid-morning / Mid-afternoon daylight">D55/10°</option>
							<option value="35" data-subtext="6504 K° - Noon daylight / Television, sRGB color space">D65/10°</option>
							<option value="36" data-subtext="7504 K° - North sky daylight">D75/10°</option>
							<option value="37" data-subtext="5454 K° - Equal energy">E/10°</option>
							<option value="38" data-subtext="6430 K° - Daylight (fluorescent)">F1/10°</option>
							<option value="39" data-subtext="4230 K° - Cool white (fluorescent)">F2/10°</option>
							<option value="40" data-subtext="3450 K° - White (fluorescent)">F3/10°</option>
							<option value="41" data-subtext="2940 K° - Warm white ((fluorescent))">F4/10°</option>
							<option value="42" data-subtext="6350 K° - Daylight (fluorescent)">F5/10°</option>
							<option value="43" data-subtext="4150 K° - Light white (fluorescent)">F6/10°</option>
							<option value="44" data-subtext="6500 K° - Daylight / D65 (Simulator)">F7/10°</option>
							<option value="45" data-subtext="5000 K° - D50 (Simulator) / Sylvania F40 Design 50">F8/10°</option>
							<option value="46" data-subtext="4150 K° - Cool white deluxe (fluorescent)">F9/10°</option>
							<option value="47" data-subtext="5000 K° - Philips TL85 / Ultralume 50">F10/10°</option>
							<option value="48" data-subtext="4000 K° - Philips TL84 / Ultralume 40">F11/10°</option>
							<option value="49" data-subtext="3000 K° - Philips TL83 / Ultralume 30">F12/10°</option>
						</optgroup>
					</select>
				</div>

				<div class="input-group mb-3">
					<div class="input-group-prepend">
						<label class="input-group-text" for="Adaptation">Adaptation method</label>
					</div>
					<select class="form-control selectpicker show-tick" data-size="5" id="Adaptation">
						<option value="0" selected>Bradford</option>
						<option value="1">Von Kries</option>
						<option value="2">XYZ Scaling</option>
						<option value="3">None</option>
					</select>
				</div>

				<div class="input-group mb-3">
					<div class="input-group-prepend">
						<label class="input-group-text" for="RGBModel">RGB model</label>
					</div>
					<select class="form-control selectpicker show-tick" data-size="5" id="RGBModel">
						<option value="0">Adobe RGB (1998)</option>
						<option value="1">AppleRGB</option>
						<option value="2">Best RGB</option>
						<option value="3">Beta RGB</option>
						<option value="4">Bruce RGB</option>
						<option value="5">CIE RGB</option>
						<option value="6">ColorMatch RGB</option>
						<option value="7">Don RGB 4</option>
						<option value="8">ECI RGB v2</option>
						<option value="9">Ekta Space PS5</option>
						<option value="10">NTSC RGB</option>
						<option value="11">PAL/SECAM RGB</option>
						<option value="12">ProPhoto RGB</option>
						<option value="13">SMPTE-C RGB </option>
						<option value="14" selected>sRGB</option>
						<option value="15">Wide Gamut RGB</option>
					</select>
				</div>

				<div class="input-group mb-3">
					<div class="input-group-prepend">
						<label class="input-group-text" for="ColorScale">Color scale</label>
					</div>
					<select class="form-control selectpicker show-tick" data-size="5" id="ColorScale">
						<option value="0" selected>None</option>
						<option value="1">Iodine Color Number</option>
						<option value="2">Hazen/APHA/PtCo Color Number</option>
						<option value="3">Gardner Color Number</option>
						<option value="4">Lovibond Color System</option>
						<option value="5">European Pharmacopoeia (EP) Color Determination</option>
						<option value="6">US Pharmacopoeia (USP) Color Determination</option>
						<option value="7">Chinese Pharmacopoeia (CP) Color Determination</option>
						<option value="8">Klett Color Number</option>
						<option value="9">Hess-Ives Color Number</option>
						<option value="10">Yellowness Index (ASTM D1925)</option>
						<option value="11">ADMI Color Number</option>
						<option value="12">Acid Wash Color Determination</option>
						<option value="13">EBC Brewery Color Number</option>
						<option value="14">ASBC Brewery Color Number</option>
						<option value="15">ASTM-Farbzahl</option>
						<option value="16">Saybolt-Farbzahl</option>
						<option value="17">ICUMSA Zuckerfarbe</option>
						<option value="18">SAC436</option>
					</select>
				</div>
			</p>

			<div class="row">
				<div class="col-md-8 offset-md-2 text-center">
					<canvas id="sRGBCanvas" width="400" height="150" style="border:1px solid #d3d3d3;">Your browser does not support the HTML canvas tag.</canvas>
				</div>
			</div>
			<div class="row">
				<div class="col-md-8 offset-md-2 text-center">
					<div id="CIExyChartBackground" style="background-image: url('CIE.png'); background-repeat:no-repeat;">
						<div id="CIExyChart"></div>
					</div>
				</div>
			</div>

			<h4 class="mt-4 mb-4">Readings</h4>
			<div id="ReadingTableToolbar">
				<button id="ReadingTableButtonReset" class="btn btn-secondary" style="width: 80px">Reset</button>
			</div>
			<table id="ReadingTable"></table>

			<h4 class="mt-4 mb-4">Protocol</h4>
			<div id="ProtocolTableToolbar">
				<button id="ProtocolTableButtonReset" class="btn btn-secondary" style="width: 80px">Reset</button>
			</div>
			<table id="ProtocolTable"></table>

			<h4 class="mt-4 mb-4">Logging</h4>
			<div id="LogTableToolbar">
				<button id="LogTableButtonBuild" class="btn btn-secondary" style="width: 80px">Enable</button>
				<button id="LogTableButtonReset" class="btn btn-secondary" style="width: 80px">Reset</button>
				<button id="LogTableButtonDestroy" class="btn btn-secondary" style="width: 80px">Disable</button>
			</div>
			<table id="LogTable"></table>
			</br>
			<footer id="sticky-footer" class="py-3 bg-primary text-white-50">
				<div class="container text-center">
					<a class="text-light" href="#" id="FooterRepository" target="_blank"></a> by
					<a class="text-light" href="#" id="FooterOwner" target="_blank"></a>
				</div>
			</footer>
		</div>
	</body>
</html>
